<!DOCTYPE html>

    <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link href="./style.css" type="text/css" rel="stylesheet">
            <link href="./travel-rizz.css" type="text/css" rel="stylesheet">
            <link href="./dist/output.css" rel="stylesheet">
            <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
            <link rel="icon" type="image/x-icon" href="/resources/TH-logo.png">
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
            <meta property="og:title" content="Travel-Rizz - Your friendly AI-powered travel companion.">
            <meta name="og:description" content="Experience the charm of travel planning with Travel-Rizz. Let AI be your guide!">
            <meta property="og:image" content="https://terrancehah.com/resources/TH-logo.jpg">
            <meta property="og:type" content="article">
            <meta property="og:url" content="https://terrancehah.com/travel-planner-index.html">
            <meta name="description" content="Travel-Rizz: Your Personalized Journey Awaits">
            <script>window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };</script>
            <script defer src="/_vercel/speed-insights/script.js"></script>
            <script defer data-domain="terrancehah.com" src="https://plausible.io/js/script.tagged-events.js"></script>
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDvcgBgSprgTRQO_6BWh5EAOPu1vdS6KD4&libraries=places&callback=initAutocomplete" async defer></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
            <script src="./footer.js"></script>
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
            </style>
            <title>Travel-Rizz - Your friendly AI-powered travel companion.</title>
        </head>

        <body>
            <header class="w-full inline-block">
                <div class="flex flex-col md:flex-row justify-between items-center p-2.5 sm:p-3">
                    <!-- Left side: Logo and Nav -->
                    <div class="flex flex-col md:flex-row items-center w-full sm:w-auto gap-1">
                        <h1 class="block font-lato font-semibold text-[#1d3557] text-2xl md:text-3xl p-0 text-center sm:w-auto">
                            Travel-Rizz
                        </h1>
                        
                        <nav class="flex flex-wrap justify-center gap-1">
                            <a href="./index.html" class="relative p-2 font-raleway font-medium text-lg md:text-xl text-[#457B9D] hover:bg-[#c0e9fc]">Home</a>
                            <a href="./articles.html" class="relative p-2 font-raleway font-medium text-lg md:text-xl text-[#457B9D] hover:bg-[#c0e9fc]">Articles</a>
                            <a href="./projects.html" class="relative p-2 font-raleway font-medium text-lg md:text-xl text-[#457B9D] hover:bg-[#c0e9fc] bg-[#c0e9fc]">Projects</a>
                            <a href="./playground.html" class="relative p-2 font-raleway font-medium text-lg md:text-xl text-[#457B9D] hover:bg-[#c0e9fc]">Playground</a>
                        </nav>
                    </div>
                
                    <!-- Right side: Social Icons -->
                    <div class="flex items-center gap-4 mt-2 md:mt-0">
                        <a href="https://facebook.com/terrancehah/" target="_blank" class="w-8 h-8">
                            <img src="./resources/facebook.png" alt="facebook" class="w-full h-full">
                        </a>
                        <a href="https://instagram.com/terrancehah/" target="_blank" class="w-8 h-8">
                            <img src="./resources/instagram.png" alt="instagram" class="w-full h-full">
                        </a>
                        <a href="https://linkedin.com/terrancehah/" target="_blank" class="w-8 h-8">
                            <img src="./resources/linkedin.png" alt="linkedin" class="w-full h-full">
                        </a>
                        <a href="https://github.com/terrancehah" target="_blank" class="w-8 h-8">
                            <img src="./resources/github.png" alt="github" class="w-full h-full">
                        </a>
                    </div>
                </div>
            </header>
            
            <main>
                    <video id="backgroundVideo" autoplay muted>
                        <source id="videoSource" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>

                    <form id="trip-form" class="w-full mx-auto">

                        <!-- Title and subtitle -->
                        <div class="relative space-y-2 p-3 text-center w-90% lg:w-4/5 md:w-4/5 mx-auto z-2">
                            <div>
                                <h1 class="font-caveat font-bold text-3xl md:text-4xl lg:text-[3.5rem] leading-tight md:leading-tight lg:leading-tight text-primary">
                                    Welcome to Travel-Rizz:
                                    <br>Your Personalized Journey Awaits
                                </h1>
                            </div>
                            <div>
                                <h3 class="font-medium text-base md:text-lg lg:text-xl leading-tight md:leading-tight lg:leading-tight text-secondary max-w-3xl mx-auto">
                                    Discover the joy of seamless travel planning with Travel-Rizz, your friendly AI travel assistant.
                                </h3>
                            </div>
                        </div> 

                        <!-- Destination -->
                        <div class="destination-input-form relative mx-auto"> 
                            <input 
                                type="search" 
                                id="destination"
                                name="city" 
                                placeholder="Let's go somewhere?" 
                                autocomplete="off"
                                class="w-80 sm:w-80 md:w-[40%] lg:w-[35%] xl:w-96 h-12 relative cursor-text text-lg px-4 py-2 bg-white bg-opacity-80 border border-[#b8b8bb] rounded-md text-gray-800 shadow-inner font-raleway transition-all duration-100 ease-in-out focus:border-[#456789] focus:shadow-sm"
                            >
                            <div id="cityList"></div>
                        </div>
                        
                        <!-- Calendar and filters -->
                        <div class="flex flex-col md:flex-row mx-auto my-2 justify-center items-center w-full md:gap-8">

                            <!-- Calendar container -->
                            <div class="flex flex-col mx-0 my-3 items-center">
                            
                                <!-- Dates box -->
                                <input 
                                        id="start-date" 
                                        name="startDate" 
                                        class="w-80 h-12 px-4 py-2 text-lg font-raleway text-gray-700 bg-white bg-opacity-80 border border-[#b8b8bb] rounded-md shadow-inner cursor-pointer transition-all duration-100 ease-in-out focus:border-[#456789] focus:shadow-sm"
                                        placeholder="Start and End Dates" 
                                        readonly 
                                        required
                                    >
                                <input type="hidden" id="hidden-end-date" name="endDate">
                                
                                <div id="start-calendar" class="w-full"></div>
                            </div>
                            
                            <!-- Filters Container -->
                            <div class="flex flex-col mx-0 my-3 w-min items-center">

                                <!-- Travel Style Section -->
                                <div class="flex flex-col md:w-min w-80 mx-0 mb-1.5 px-5 py-5 border border-[#b8b8bb] rounded-lg bg-white bg-opacity-80">
                                    
                                    <!-- Section Title -->
                                    <label class="text-lg font-raleway font-semibold text-gray-700 mb-2 text-left w-full">Travel Style</label>
                                    
                                    <!-- Travel Style Selections Ticks -->
                                    <div class="flex flex-wrap gap-3 justify-start items-start text-left w-full">
                                        <label class="group inline-flex items-center justify-start px-4 py-1.5 border border-[#b8b8bb] ml-0 rounded-md cursor-pointer bg-white bg-opacity-40 font-light transition-colors duration-200">
                                            <input type="checkbox" name="travel-style" value="natural" class="peer mr-2 appearance-none h-5 w-5 border border-[#b8b8bb] rounded bg-white checked:bg-[#456789] checked:border-transparent cursor-pointer relative checked:after:content-['âœ“'] checked:after:absolute checked:after:text-white checked:after:text-xs checked:after:top-[2px] checked:after:left-[3px]">
                                            <span class="text-left peer-checked:text-secondary">Natural ğŸ€</span>
                                            <div class="absolute inset-0 rounded-md bg-[#456789] opacity-0 peer-checked:opacity-100 transition-opacity duration-200 -z-10"></div>
                                        </label>
                                        <label class="group inline-flex items-center justify-start px-4 py-1.5 border border-[#b8b8bb] ml-0 rounded-md cursor-pointer bg-white bg-opacity-40 font-light transition-colors duration-200">
                                            <input type="checkbox" name="travel-style" value="cultural" class="peer mr-2 appearance-none h-5 w-5 border border-[#b8b8bb] rounded bg-white checked:bg-[#456789] checked:border-transparent cursor-pointer relative checked:after:content-['âœ“'] checked:after:absolute checked:after:text-white checked:after:text-xs checked:after:top-[2px] checked:after:left-[3px]">
                                            <span class="text-left peer-checked:text-secondary">Cultural ğŸ</span>
                                            <div class="absolute inset-0 rounded-md bg-[#456789] opacity-0 peer-checked:opacity-100 transition-opacity duration-200 -z-10"></div>
                                        </label>
                                        <label class="group inline-flex items-center justify-start px-4 py-1.5 border border-[#b8b8bb] ml-0 rounded-md cursor-pointer bg-white bg-opacity-40 font-light transition-colors duration-200">
                                            <input type="checkbox" name="travel-style" value="foodie" class="peer mr-2 appearance-none h-5 w-5 border border-[#b8b8bb] rounded bg-white checked:bg-[#456789] checked:border-transparent cursor-pointer relative checked:after:content-['âœ“'] checked:after:absolute checked:after:text-white checked:after:text-xs checked:after:top-[2px] checked:after:left-[3px]">
                                            <span class="text-left peer-checked:text-secondary">Foodie ğŸ±</span>
                                            <div class="absolute inset-0 rounded-md bg-[#456789] opacity-0 peer-checked:opacity-100 transition-opacity duration-200 -z-10"></div>
                                        </label>
                                        <label class="group inline-flex items-center justify-start w-max px-4 py-1.5 border border-[#b8b8bb] ml-0 rounded-md cursor-pointer bg-white bg-opacity-40 font-light transition-colors duration-200">
                                            <input type="checkbox" name="travel-style" value="adventurous" class="peer mr-2 appearance-none h-5 w-5 border border-[#b8b8bb] rounded bg-white checked:bg-[#456789] checked:border-transparent cursor-pointer relative checked:after:content-['âœ“'] checked:after:absolute checked:after:text-white checked:after:text-xs checked:after:top-[2px] checked:after:left-[3px]">
                                            <span class="text-left peer-checked:text-secondary">Adventurous ğŸª‚</span>
                                            <div class="absolute inset-0 rounded-md bg-[#456789] opacity-0 peer-checked:opacity-100 transition-opacity duration-200 -z-10"></div>
                                        </label>
                                    </div>
                                </div>

                                <!-- Language Select Section -->
                                <div class="flex w-[100%] mx-0 my-1.5 items-center">
                                    <select 
                                        id="language"
                                        class="w-full h-12 outline-none cursor-pointer border border-[#b8b8bb] px-2 py-2 text-lg font-raleway text-gray-700 rounded-md bg-white bg-opacity-80 shadow-inner hover:bg-white hover:text-black"
                                    >
                                        <option value="" disabled selected>Select Language</option>
                                        <option value="en">English</option>
                                        <option value="ms">Malay (Bahasa Melayu)</option>
                                        <option value="es">EspaÃ±ol</option>
                                        <option value="fr">FranÃ§ais</option>
                                        <option value="de">Deutsch</option>
                                        <option value="it">Italiano</option>
                                        <option value="cs">Czech (ÄŒeÅ¡tina)</option>
                                        <option value="zh-CN">Simplified Chinese (ç®€ä½“ä¸­æ–‡)</option>
                                        <option value="zh-TW">Traditional Chinese (ç¹é«”ä¸­æ–‡)</option>
                                        <option value="ja">Japanese (æ—¥æœ¬èª)</option>
                                        <option value="ko">Korean (í•œêµ­ì–´)</option>
                                    </select>
                                </div>

                                <!-- Budget Select Section -->
                                <div class="flex w-[100%] mx-0 mt-1 items-center">
                                    <select 
                                        id="budget"
                                        class="w-full h-12 outline-none cursor-pointer border border-[#b8b8bb] px-2 py-2 text-lg font-raleway text-gray-700 rounded-md bg-white bg-opacity-80 shadow-inner hover:bg-white hover:text-black"
                                    >
                                        <option value="" disabled selected>Select Budget</option>
                                        <option value="budget">Budget ($ - $$)</option>
                                        <option value="midrange">Mid-range ($$ - $$$)</option>
                                        <option value="luxury">Luxury ($$$+)</option>
                                    </select>
                                </div>
                                
                            </div>
                            
                        </div>
                        
                        <!-- Submit button -->
                        <div class="w-[90%] md:w-[66%] lg:w-[40%] xl:w-[33%] mx-auto my-4 text-center">
                            <button 
                                id="generate-button" 
                                type="submit"
                                class="w-[200px] h-12 rounded-lg bg-white text-[#3a7dc9e6] font-raleway font-semibold text-lg shadow-lg hover:bg-[#3a7dc9e6] hover:text-white hover:shadow-xl transition-all duration-300 ease-in-out hover:-translate-y-0.5"
                            >
                                Take Me There
                            </button>
                        </div>
                        
                        <!-- //Test button -->
                        <!-- <button id="loadTestData" type="submit">Load Test Data</button> -->

                    </form>
            </main>

            <div id="popupWindow" class="popup-window">
                <div class="popup-content">
                    <span class="close-btn" onclick="closePopup()">&times;</span>
                    <div id="generatedContent" class="generated-content">
                    </div>
                    <button id="exportPDF">Export as PDF</button>
                </div>
            </div>
            <div id="loadingSpinner" style="display: none;">
                <img id="plane" src="resources/flyingplane-crop.gif"  alt="Loading..."/>
                <p>Fasten your seat belt while we are working on your travel itinerary...</p>
            </div>            

            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

            <!-- <script>
                var wrappers = $(".button-wrapper");
            
                $(".submit").click(function(e) {
                    e.preventDefault();
            
                    var clickedWrapper = $(this).parent(".button-wrapper");
            
                    if(!clickedWrapper.hasClass("checked")) {
                        clickedWrapper.addClass("checked");
            
                        setTimeout(function(){
                            window.location.href = $(e.target).attr("href");
                        }, 5000);
            
                        setTimeout(function(){
                            clickedWrapper.removeClass("checked");
                        }, 8000);
                    }
                });
            </script> -->


            <script>
                //Random loop autoplay background videos
                document.addEventListener('DOMContentLoaded', function() {
                    var videos = [
                        './resources/Dubai_Night_1080P_20X_compressed.mp4',
                        './resources/London_Skyline_720P_8X_compressed.mp4',
                        './resources/Patagonia_Lake_720P_20X_compressed.mp4',
                        './resources/Grand_Canyon_720P_8X_compresed.mp4',
                        './resources/Greenland_Evening_1080P_20X_compressed.mp4',
                        './resources/San_Fransisco_Bay_720P_5X_compressed.mp4'
                        // Add more video paths as needed
                    ];
            
                    // Randomly select the first video
                    var firstVideoIndex = Math.floor(Math.random() * videos.length);
                    var videoElement = document.getElementById('backgroundVideo');
                    videoElement.src = videos[firstVideoIndex];
                    videoElement.load(); // Ensure the new source is loaded
            
                    videoElement.addEventListener('ended', function(e) {
                        // Determine the next video index
                        var currentVideoIndex = videos.indexOf(videoElement.getAttribute('src'));
                        var nextVideoIndex = (currentVideoIndex + 1) % videos.length;
                        videoElement.src = videos[nextVideoIndex];
                        videoElement.load(); // Load the new video source
                        videoElement.play(); // Play the next video
                    });
                });
            </script>            

            <script async
            src="https://js.stripe.com/v3/buy-button.js">
            </script>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    var stripeButton = document.querySelector('.stripe-buy-button');
                    if (stripeButton) {
                        stripeButton.addEventListener('click', function() {
                        plausible('Stripe Purchase Button Click');
                        });
                    }
                });
            </script>

            <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

            <script>
                // City name autocomplete
                function initAutocomplete() {
                    var input = document.getElementById('destination');
                    var autocomplete = new google.maps.places.Autocomplete(input);
                    autocomplete.addListener('place_changed', function() {
                        var place = autocomplete.getPlace();
                        if (!place.geometry) {
                            console.log("No details available for input: '" + place.name + "'");
                            return;
                        }

                        // Extract city and country from address components
                        var city, country;
                        for (var i = 0; i < place.address_components.length; i++) {
                            var component = place.address_components[i];
                            if (component.types.includes("locality")) {
                                city = component.long_name;
                            }
                            if (component.types.includes("country")) {
                                country = component.long_name;
                            }
                        }

                        var simplifiedPlaceName = city && country ? city + ", " + country : place.name;
                        console.log('Simplified place name:', simplifiedPlaceName);
                    });
                }
            </script>
            

            <script>
                var today = new Date();
                var mainCalendar, endCalendar;
                var currentMode = "";

                function initializeCalendar() {
                    if (mainCalendar) {
                        mainCalendar.destroy();
                    }
                    
                    mainCalendar = flatpickr("#start-calendar", {
                        inline: true,
                        dateFormat: "d-m-Y",
                        minDate: today,
                        mode: "range",
                        static: true,
                        maxRange: 5,
                        appendTo: document.getElementById('start-calendar'),
                        onChange: function(selectedDates, dateStr) {
                            if (selectedDates.length === 2) {
                                var startDateFormatted = flatpickr.formatDate(selectedDates[0], "d-m-Y");
                                var endDateFormatted = flatpickr.formatDate(selectedDates[1], "d-m-Y");
                                document.getElementById("start-date").value = `${startDateFormatted} to ${endDateFormatted}`;
                                document.getElementById("hidden-end-date").value = endDateFormatted;
                            } else {
                                document.getElementById("start-date").value = dateStr;
                                document.getElementById("hidden-end-date").value = dateStr;
                            }
                        }
                    });

                    // Center align the calendar
                    const calendarContainer = document.getElementById('start-calendar');
                    const calendarElem = calendarContainer.querySelector('.flatpickr-calendar');
                    if (calendarElem) {
                        calendarElem.style.margin = '0 auto';
                        calendarElem.style.position = 'relative';
                        calendarElem.style.display = 'inline-block';
                    }
                }

                // Initialize calendar on load and resize
                window.addEventListener('load', initializeCalendar);
                let resizeTimer;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(initializeCalendar, 250);
                });
            </script>

            <script>
                // Listen to the input, parse into JSON format and receive the JSON format response
                document.getElementById("trip-form").addEventListener("submit", function(e) {
                    e.preventDefault();

                    // Show loading spinner
                    document.getElementById("loadingSpinner").style.display = "flex";

                    var isMobile = window.matchMedia("only screen and (max-width: 1024px)").matches;
                    var city = document.getElementById("destination").value;
                    var startDate = document.getElementById("start-date").value;
                    var endDate = document.getElementById("hidden-end-date").value;                    
                    var language = document.getElementById("language").value;
                    var budget = document.getElementById("budget").value;

                    // Log the raw values
                    console.log('Raw form values:', {
                        city,
                        startDate,
                        endDate,
                        language,
                        budget
                    });
                    
                    // // Validate data before sending
                    if (!city || !startDate || !endDate || !language || !budget) {
                        document.getElementById("loadingSpinner").style.display = "none";
                        alert('Please fill in all required fields');
                        return;
                    }

                    // Use explicit object notation
                    var requestData = {
                        "language": language,
                        "city": city,
                        "startDate": startDate,
                        "endDate": endDate,
                        "budget": budget
                    };

                    var isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                    const apiUrl = isLocal ? 'http://localhost:3000/api/travel-rizz-server' : '/api/travel-rizz-server';

                    // Log the request for debugging
                    console.log('Sending request:', {
                        url: apiUrl,
                        data: requestData
                    });

                    // Make the fetch request
                    fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestData)
                    })
                    .then(response => {
                        console.log('Response status:', response.status);
                        return response.json();  // Use response.json() directly
                    })
                    .then(data => {
                        // Log received data
                        console.log('Parsed data:', data);
                        
                        // Validate received content
                        if (!data || typeof data.generatedContent !== 'string') {
                            console.error('Invalid response format:', data);
                            throw new Error('Invalid response format from server');
                        }

                        console.log('Success:', data);
                        if (data.generatedContent) {
                            document.getElementById("generatedContent").innerHTML = data.generatedContent;
                            document.getElementById("loadingSpinner").style.display = "none";
                            openPopup();
                        } else {
                            throw new Error('No content received from server');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById("loadingSpinner").style.display = "none";
                        
                        // More descriptive error message
                        if (error.name === 'SyntaxError') {
                            alert('Received malformed data from server. Please try again.');
                        } else {
                            alert(`Error: ${error.message || 'Failed to generate itinerary'}`);
                        }
                    });
                });
            </script>
            

            <!-- // Static data for testing only -->
            <!-- <script>
                var testData = 
                    `
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h1>æ¬¢è¿æ¥åˆ°éº»å¡ï¼</h1>
                        <h2>åŸå¸‚ä»‹ç»</h2>
                        <p>éº»å¡æ˜¯é©¬æ¥è¥¿äºšæŸ”ä½›å·çš„ä¸€åº§å…·æœ‰æ‚ ä¹…å†å²å’Œä¸°å¯Œæ–‡åŒ–åº•è•´çš„åŸå¸‚ã€‚å®ƒä»¥å…¶ç¾ä¸½çš„ä¼ ç»Ÿå»ºç­‘ã€ç²¾å½©çš„è¡—å¤´ç¾é£Ÿå’Œå‹å¥½çš„å±…æ°‘è€Œé—»åï¼Œå¸å¼•ç€ä¼—å¤šæ¸¸å®¢å‰æ¥æ¢ç´¢ã€‚éº»å¡è¿˜æ˜¯è¿æ¥æŸ”ä½›å·å’Œé©¬å…­ç”²çš„é‡è¦äº¤é€šæ¢çº½ï¼Œæ–¹ä¾¿æ—…å®¢åœ¨è¿™ä¸¤åœ°ä¹‹é—´å¾€è¿”ã€‚</p>
                        <h2>å­£èŠ‚ä¸æ°”å€™</h2>
                        <p>éº»å¡çš„æ°”å€™ä¸ºå…¸å‹çš„çƒ­å¸¦é›¨æ—æ°”å€™ï¼Œå…¨å¹´æ¸©æš–æ½®æ¹¿ï¼Œå……æ»¡æ´»åŠ›ã€‚æ¯å¹´çš„10æœˆåˆ°11æœˆå±äºé›¨å­£ï¼Œé™é›¨è¾ƒä¸ºé¢‘ç¹ã€‚ç„¶è€Œï¼Œé™é›¨é€šå¸¸è¾ƒä¸ºçŸ­æš‚ï¼Œä¹‹åä¾¿æ˜¯æ¹¿æ¶¦çš„æ™´å¤©ï¼Œé€‚åˆæ—…è¡Œã€‚è®¿é—®æœŸé—´çš„å¤©æ°”æƒ…å†µå¯ä»¥å‚è€ƒ<a href="https://www.accuweather.com/en/my/muar/233140/october-weather/233140?year=2024" target="_blank">Muar November 2024 Weather</a>ã€‚</p>
                        <h2>è¯­è¨€</h2>
                        <p>åœ¨éº»å¡ï¼Œä¸»è¦è¯­è¨€åŒ…æ‹¬é©¬æ¥è¯­ã€ä¸­æ–‡ï¼ˆæ™®é€šè¯åŠå„æ–¹è¨€ï¼‰å’Œè‹±è¯­ã€‚ç”±äºå½“åœ°å¤šå…ƒæ–‡åŒ–çš„ç‰¹å¾ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨å¸‚åœºã€é¤é¦†åŠå•†é“ºå¬åˆ°å¤šç§è¯­è¨€çš„äº¤æµã€‚è¯­è¨€çš„å¤šæ ·æ€§ä¸ºæ¸¸å®¢ä¸æœ¬åœ°äººä¹‹é—´çš„äº’åŠ¨å¢æ·»äº†ä¾¿åˆ©ã€‚</p>
                        <h2>äººå£</h2>
                        <p>éº»å¡çš„äººå£å¤§çº¦ä¸º23ä¸‡äººï¼Œæ„æˆå¤šå…ƒçš„ç§æ—ä¸æ–‡åŒ–ç¤¾åŒºã€‚è¿™é‡Œå±…æ°‘ä¸»è¦ç”±é©¬æ¥æ—ã€åäººå’Œå°åº¦è£”ç­‰ç»„æˆï¼Œè¿™ç§ä¸°å¯Œçš„æ–‡åŒ–èæ±‡å¢å¼ºäº†éº»å¡çš„é­…åŠ›ã€‚</p>
                    </div>
                    
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header> 
                        <h1>Notable Details about Muar, Johor</h1>
                        <h2>è´§å¸ä¿¡æ¯</h2>
                        <p>Muarä½äºé©¬æ¥è¥¿äºšï¼Œä½¿ç”¨çš„è´§å¸æ˜¯é©¬æ¥è¥¿äºšä»¤å‰(MYR)ã€‚ä¸ºäº†è·å¾—å®æ—¶æ±‡ç‡ä¿¡æ¯ï¼Œè¯·è®¿é—®<a href="https://www.x-rates.com/table/?from=MYR&amount=1" target="_blank">æ±‡ç‡è¡¨</a>ã€‚å»ºè®®éšèº«æºå¸¦å°‘é‡ç°é‡‘ï¼Œä»¥ä¾¿åœ¨è¾ƒå°çš„å•†åº—å’Œå¸‚åœºä½¿ç”¨ã€‚</p>
                        <h2>å®‰å…¨æç¤º</h2>
                        <p>Muaræ€»ä½“ä¸Šæ˜¯ä¸€ä¸ªå®‰å…¨çš„æ—…è¡Œç›®çš„åœ°ï¼Œä½†ä»éœ€æ³¨æ„åŸºæœ¬å®‰å…¨æªæ–½ã€‚å»ºè®®æ¸¸å®¢å°½é‡é¿å…åœ¨å¤œé—´ç‹¬è‡ªå‡ºè¡Œï¼Œå¹¶éšæ—¶æ³¨æ„ä¸ªäººç‰©å“ï¼Œä»¥é˜²æ‰’çªƒäº‹ä»¶å‘ç”Ÿã€‚</p>
                        <h2>è¥ä¸šæ—¶é—´</h2>
                        <p>åœ¨Muarï¼Œå¤§éƒ¨åˆ†å•†åº—å’Œé¤å…çš„è¥ä¸šæ—¶é—´ä¸ºä¸Šåˆ10ç‚¹è‡³æ™šä¸Š10ç‚¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸäº›åœ°æ–¹å¯èƒ½åœ¨ç¥·å‘Šæ—¶é—´ï¼ˆå‘¨äº”ä¸­åˆï¼‰çŸ­æš‚å…³é—­ã€‚</p>
                        <h2>å½“åœ°äº¤é€š</h2>
                        <p>åœ¨Muarï¼Œæ¸¸å®¢å¯ä»¥é€šè¿‡å…¬å…±å·´å£«ã€å‡ºç§Ÿè½¦æˆ–ç§Ÿèµè‡ªè¡Œè½¦è¿›è¡Œå¯¼èˆªã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯ä¸æ—¶åˆ»è¡¨ï¼Œè¯·è®¿é—®å…¬å…±äº¤é€šç›¸å…³ç½‘ç«™ï¼Œä½¿ç”¨å¯¼èˆªå·¥å…·æ—¶ï¼Œå¯é€šè¿‡æ‰‹æœºåº”ç”¨ç¨‹åºè·å–æŒ‡è·¯æœåŠ¡ã€‚</p>
                    </div>
                    
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h1>2024å¹´11æœˆ10æ—¥: æ¢ç´¢éº»å¡çš„é­…åŠ›</h1>
                        <h2><strong>ä¸Šåˆ</strong></h2>
                        <p>æ‚¨çš„éº»å¡ä¹‹æ—…ä»å‚è§‚<a href="https://www.google.com/maps/search/?api=1&query=%E9%BA%BB%E5%9D%A1%E5%A4%A7%E9%92%9F%E6%A5%BC%2C%20muar%2C%20johor" target="_blank">éº»å¡å¤§é’Ÿæ¥¼</a>å¼€å§‹ã€‚éº»å¡å¤§é’Ÿæ¥¼æ˜¯è¿™åº§åŸå¸‚çš„è±¡å¾ä¹‹ä¸€ï¼Œå»ºäº1909å¹´ã€‚åœ¨è¿™åº§é«˜è€¸çš„å»ºç­‘ä¸­ï¼Œæ‚¨å¯ä»¥æ„Ÿå—åˆ°å†å²çš„æ²‰æ·€ã€‚ä»è¿™é‡Œå‡ºå‘ï¼Œæ­¥è¡Œä¸ä¹…å³å¯åˆ°è¾¾<a href="https://www.google.com/maps/search/?api=1&query=%E9%BA%BB%E5%9D%A1%E8%80%81%E8%A1%97%2C%20muar%2C%20johor" target="_blank">éº»å¡è€è¡—</a>ã€‚è¿™æ¡è¡—é“å……æ»¡äº†é©¬æ¥è¥¿äºšçš„è€å¼å•†é“ºå’Œåœ°é“çš„é£Ÿå“æ‘Šä½ï¼Œè®©æ‚¨ä½“éªŒæœ¬åœ°äººçš„æ—¥å¸¸ç”Ÿæ´»ã€‚</p>
                        <h2><strong>ä¸‹åˆ</strong></h2>
                        <p>åˆé¤åï¼Œæ‚¨å¯ä»¥æ­¥è¡Œè‡³é™„è¿‘çš„<a href="https://www.google.com/maps/search/?api=1&query=%E6%B8%85%E7%9C%9F%E5%AF%BA%E8%8B%8F%E4%B8%B9%E4%BE%9D%E5%B8%83%E6%8B%89%E6%AC%A3%E5%A4%A7%E5%8E%A6%2C%20muar%2C%20johor" target="_blank">æ¸…çœŸå¯ºè‹ä¸¹ä¾å¸ƒæ‹‰æ¬£å¤§å¦</a>ï¼Œè¿™æ˜¯ä¸€åº§èåˆäº†æ‘©å°”ä¸ç»´å¤šåˆ©äºšé£æ ¼çš„ä¼˜é›…å»ºç­‘ã€‚éšåå‰å¾€<a href="https://www.google.com/maps/search/?api=1&query=%E9%BA%BB%E5%9D%A1%E8%89%BA%E6%9C%AF%E8%A1%97%2C%20muar%2C%20johor" target="_blank">éº»å¡è‰ºæœ¯è¡—</a>ï¼Œè¿™é‡Œçš„å¢™å£ä¸Šè£…é¥°ç€äº”å½©ç¼¤çº·çš„å£ç”»å’Œåˆ›æ–°çš„è‰ºæœ¯ä½œå“ï¼Œéå¸¸é€‚åˆæ‹ç…§ç•™å¿µã€‚æ‰€æœ‰è¿™äº›æ™¯ç‚¹éƒ½åœ¨æ­¥è¡Œè·ç¦»ä¹‹å†…ï¼Œè®©æ‚¨è½»æ¾ç•…æ¸¸ã€‚</p>
                        <h2><strong>æ™šä¸Š</strong></h2>
                        <p>æ™šä¸Šï¼Œå‰å¾€<a href="https://www.google.com/maps/search/?api=1&query=Tanjung%20Emas%20%E5%85%AC%E5%9B%AD%2C%20muar%2C%20johor" target="_blank">Tanjung Emas å…¬å›­</a>ï¼Œè¿™æ˜¯å½“åœ°å±…æ°‘çš„çƒ­é—¨ä¼‘é—²åœºæ‰€ã€‚åœ¨å…¬å›­é‡Œï¼Œæ‚¨å¯ä»¥æ¼«æ­¥äºæµ·æ»¨å°å¾„ï¼Œæ¬£èµå¤•é˜³ä¸‹çš„éº»å¡æ²³ç¾æ™¯ã€‚å¦‚æœé¥¿äº†ï¼Œä¸è¿œå¤„æœ‰ä¸€å®¶å—æ¬¢è¿çš„é¤é¦†ï¼Œ<a href="https://www.google.com/maps/search/?api=1&query=Jeti%20Laut%20%E5%B7%B4%E5%8E%98%E9%A3%8E%E5%91%B3%E9%A4%90%E5%8E%85%2C%20muar%2C%20johor" target="_blank">Jeti Laut å·´å˜é£å‘³é¤å…</a>ï¼Œæä¾›æ–°é²œçš„æµ·é²œä½³è‚´ã€‚</p>
                        <h2><strong>å¤œé—´</strong></h2>
                        <p>ç»“æŸè¿™ä¸€å¤©çš„è¡Œç¨‹ï¼Œå¯ä»¥åœ¨<a href="https://www.google.com/maps/search/?api=1&query=%E9%BA%BB%E5%9D%A1%E6%B2%B3%E6%BB%A8%E9%95%BF%E5%BB%8A%2C%20muar%2C%20johor" target="_blank">éº»å¡æ²³æ»¨é•¿å»Š</a>æ¼«æ­¥ï¼Œäº«å—å‚æ™šçš„å‡‰é£å’ŒåŸå¸‚å¤œæ™¯ã€‚æ²³æ»¨æ­¥é“ä¸Šè®¾æœ‰å¤šå¤„ç¾ä¸½çš„ç¯å…‰è£…é¥°ï¼Œç»™å¤œæ™šå¢åŠ äº†ä¸å°‘æµªæ¼«æ°”æ¯ã€‚</p>
                    </div>
                    
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h1>æ—…è¡Œæé†’</h1><h2>æ—…è¡Œæ–‡ä»¶å’Œç­¾è¯è¦æ±‚</h2><p>è¯·ç¡®ä¿æ‚¨çš„æŠ¤ç…§åœ¨å…¥å¢ƒè‡³å°‘å…­ä¸ªæœˆå†…æœ‰æ•ˆã€‚æœ‰å…³ç­¾è¯è¦æ±‚ï¼Œæ‚¨å¯ä»¥è®¿é—® <a href="https://mzv.gov.cz/jnp/en/information_for_aliens/visa_form/index.html" target="_blank">å®˜æ–¹ç­¾è¯ç”³è¯·ç½‘ç«™</a> äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚</p>
                        <h2>é€€ç¨æ‰‹ç»­</h2>
                        <p>åœ¨é©¬æ¥è¥¿äºšè´­ç‰©æ—¶ï¼Œè¯·ç•™æ„å‚ä¸é€€ç¨è®¡åˆ’çš„å•†åº—ã€‚ç¦»å¢ƒæ—¶å¯åˆ°æœºåœºåŠç†é€€ç¨æ‰‹ç»­ï¼Œæºå¸¦å¥½ç›¸å…³å‘ç¥¨å’Œå•†å“ã€‚</p>
                        <h2>æœ€æ–°æ—¶äº‹å’Œå»ºè®®</h2>
                        <p>è¯·åŠæ—¶å…³æ³¨æœ€æ–°çš„æ—…è¡Œå…¬å‘Šå’Œå®‰å…¨å»ºè®®ã€‚äº†è§£å’Œéµå¾ªå½“åœ°æ”¿åºœçš„æŒ‡å¯¼ï¼Œä»¥ç¡®ä¿å®‰å…¨æ— è™ã€‚</p>
                        <h2>å½“åœ°ç¤¼ä»ªå’Œæ–‡åŒ–è§„èŒƒ</h2>
                        <p>å°Šé‡å½“åœ°æ–‡åŒ–æ˜¯å¾ˆé‡è¦çš„ã€‚åœ¨ç©†æ–¯æ—åŒºåŸŸï¼Œç€è£…å®œä¿å®ˆã€‚æ­¤å¤–ï¼Œé©¬æ¥è¥¿äºšäººé€šå¸¸æ¯”è¾ƒçƒ­æƒ…å‹å¥½ï¼Œè§é¢é—®å€™æ—¶å¯è¯´â€œä½ å¥½â€æˆ–ä½¿ç”¨å½“åœ°çš„é©¬æ¥è¯­â€œSelamat sejahteraâ€ã€‚</p>
                        <h2>å¥åº·å’Œç–«è‹—æ¥ç§è®°å½•è¦æ±‚</h2><p>å»ºè®®æ—…å®¢å‰å¾€é©¬æ¥è¥¿äºšå‰ç¡®è®¤æ‰€éœ€ç–«è‹—æ¥ç§æƒ…å†µã€‚ç¡®ä¿æºå¸¦æœ€æ–°çš„ç–«è‹—æ¥ç§è®°å½•ï¼Œä»¥å¤‡ä¸æ—¶ä¹‹éœ€ã€‚</p>
                    </div>
                    
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h1>ç´§æ€¥è”ç³»æ–¹å¼</h1>
                        <h2>ç´§æ€¥ç”µè¯</h2>
                        <p>è­¦å¯Ÿï¼š999</p><p>æ•‘æŠ¤è½¦ï¼š999</p><p>æ¶ˆé˜²é˜Ÿï¼š994</p>
                        <h2>åŒ»é™¢</h2>
                        <p>Tunku Ampuan Najihah Hospital<br>ç”µè¯ï¼š06-952 2600<br>åœ°å€ï¼šJalan Temenggung, 84000 Muar, Johor, Malaysia<br><a href="https://goo.gl/maps/LBf6neEzfzQ2" target="_blank"><a href="https://www.google.com/maps/search/?api=1&query=Tunku%20Ampuan%20Najihah%20Hospital%2C%20muar%2C%20johor" target="_blank">Tunku Ampuan Najihah Hospital</a></a></p>
                        <p>Sultanah Fatimah Specialist Hospital<br>ç”µè¯ï¼š06-952 2500<br>åœ°å€ï¼šJalan Salleh, 84000 Muar, Johor, Malaysia<br><a href="https://goo.gl/maps/ZTPpS2EmZ8K2" target="_blank"><a href="https://www.google.com/maps/search/?api=1&query=Sultanah%20Fatimah%20Specialist%20Hospital%2C%20muar%2C%20johor" target="_blank">Sultanah Fatimah Specialist Hospital</a></a></p>
                        <h2>ä½¿é¦†ä¿¡æ¯</h2>
                        <p>ä¸ºäº†ç¡®ä¿æ‚¨çš„å®‰å…¨ï¼Œè¯·ç‰¢è®°æ‚¨æ‰€åœ¨å›½åœ¨é©¬æ¥è¥¿äºšçš„ä½¿é¦†æˆ–é¢†äº‹é¦†çš„åœ°å€å’Œè”ç³»ä¿¡æ¯ã€‚è¯¦æƒ…è¯·è®¿é—® <a href="https://www.embassy-worldwide.com/" target="_blank">å…¨çƒä½¿é¦†æŒ‡å—</a>ã€‚</p>
                    </div>

                    <div class="page-break"><header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h2 id='conclusion'>æˆ‘ä»¬è¡·å¿ƒç¥æ„¿æ‚¨åœ¨éº»å¡çš„æ—…ç¨‹å……æ»¡ä¹è¶£ä¸æƒŠå–œã€‚æˆ‘ä»¬çƒ­æƒ…åœ°é‚€è¯·æ‚¨åœ¨æ—…é€”ä¸­ç•™ä¸‹ç¾å¥½å›å¿†ï¼Œå¹¶å¸Œæœ›æ‚¨èƒ½åœ¨çº¿åˆ†äº«æ‚¨çš„ä½“éªŒå’Œåé¦ˆã€‚å¦‚æœæˆ‘ä»¬çš„è¡Œç¨‹å®‰æ’å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œæˆ‘ä»¬ä¼šæ„Ÿåˆ°éå¸¸è£å¹¸ã€‚</h2>
                    </div>
                    `

                document.getElementById('loadTestData').addEventListener('click', function() {
                    document.getElementById("generatedContent").innerHTML = testData;
                    openPopup();
                });
            </script> -->

            <script>
                function openPopup() {
                    document.getElementById("popupWindow").style.display = "block";
                }

                function closePopup() {
                    document.getElementById("popupWindow").style.display = "none";
                }
            </script>

            <script>
                document.getElementById('exportPDF').addEventListener('click', function(e) {
                    e.preventDefault();

                    var isMobile = window.matchMedia("only screen and (max-width: 1024px)").matches;
                    var city = document.getElementById("destination").value;
                    var originalContent = document.getElementById("generatedContent");
                    var startDate = document.getElementById("start-date").value;
                    var endDate = document.getElementById("end-date").value;

                    // Clone the content for PDF generation
                    var contentForPdf = originalContent.cloneNode(true);
                    contentForPdf.id = 'contentForPdf';
                    document.body.appendChild(contentForPdf);

                    // Apply PDF specific font sizing
                    contentForPdf.querySelectorAll('h1').forEach(el => el.style.fontSize = '50px');
                    contentForPdf.querySelectorAll('h2').forEach(el => el.style.fontSize = '32px');
                    contentForPdf.querySelectorAll('.generated-content #brand').forEach(el => el.style.fontSize = '26px');
                    contentForPdf.querySelectorAll('.generated-content #header-slogan').forEach(el => el.style.fontSize = '20px');
                    contentForPdf.querySelectorAll('strong').forEach(el => el.style.fontSize = '22px');
                    contentForPdf.querySelectorAll('p').forEach(el => el.style.fontSize = '18px');                    
                    // contentForPdf.querySelectorAll('.page-break').forEach(el => el.style.marginBottom = '0');                    
                    // contentForPdf.querySelectorAll('img').forEach(el => el.style.marginTop = '0.5%');
                    // contentForPdf.querySelectorAll('#conclusion').forEach(el => el.style.height = '95vh');

                    // Style headers
                    contentForPdf.querySelectorAll('.generated-content header').forEach(header => {
                        header.style.display = 'inline-flex';
                        // header.style.position = 'absolute';
                        header.style.top = '0';
                        header.style.left = '0';
                        header.style.right = '0';
                        // header.style.padding = '20px';
                    });

                    // Get all page breaks and identify the last one
                    const pageBreaks = contentForPdf.querySelectorAll('.page-break');
                    const lastPageIndex = pageBreaks.length - 1;

                    // Style page breaks and handle content
                    pageBreaks.forEach((el, index) => {
                        el.style.position = 'relative';
                        el.style.display = 'flex';
                        el.style.flexDirection = 'column';
                        el.style.minHeight = '100vh';

                        
                        // Only set minHeight for non-last pages
                        // if (index !== lastPageIndex) {
                        //     el.style.minHeight = '100vh';
                        // }
                        
                        // Create content wrapper
                        const content = document.createElement('div');
                        content.style.flex = '1';
                        content.style.display = 'flex';
                        content.style.flexDirection = 'column';
                        content.style.justifyContent = 'center';
                        
                        // Special handling for conclusion page
                        const conclusionH2 = el.querySelector('#conclusion');
                        if (conclusionH2) {
                            conclusionH2.style.whiteSpace = 'normal';
                            conclusionH2.style.width = '95%';
                            conclusionH2.style.maxWidth = '100%';
                            conclusionH2.style.wordBreak = 'normal';
                            conclusionH2.style.wordWrap = 'break-word';
                            conclusionH2.style.overflowWrap = 'break-word';
                            conclusionH2.style.textAlign = 'center';
                            conclusionH2.style.display = 'block';
                            conclusionH2.style.lineHeight = '1.5';
                            conclusionH2.style.margin = '0 auto';
                            conclusionH2.style.padding = '20px';  // Increased padding

                            // Force the conclusion page to take up full height
                            el.style.minHeight = '100vh';
                            // el.style.height = '100vh';

                            // Ensure content is centered vertically
                            content.style.flex = '1';
                            content.style.display = 'flex';
                            content.style.alignItems = 'center';
                            content.style.justifyContent = 'center';
                            
                            // Remove any bottom margin/padding that might cause extra space
                            el.style.marginBottom = '0';
                            el.style.paddingBottom = '0';
                            content.style.margin = '0';
                            content.style.marginBottom = '0';
                            content.style.paddingBottom = '0';
                            
                            // // For the conclusion page, set a specific height
                            // if (index === lastPageIndex) {
                            //     el.style.height = 'auto';
                            //     el.style.minHeight = 'auto';
                            //     // content.style.paddingBottom = '40px'; // Add some bottom padding
                            // }
                        }

                        // Move all non-header content to wrapper
                        Array.from(el.children).forEach(child => {
                            if (child.tagName.toLowerCase() !== 'header') {
                                content.appendChild(child);
                            }
                        });
                        
                        el.appendChild(content);
                    });

                    var opt = {
                        margin: [10, 17, 12, 17],
                        filename: city + '_' + 'Travel_Itinerary' + '_' + startDate + '_to_' + endDate + '.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { 
                            scale: 2,
                            useCORS: true,
                            scrollY: 0,
                            // windowWidth: document.documentElement.clientWidth,   // Ensure full width is captured
                            // windowHeight: document.documentElement.clientHeight, // Ensure full height is captured
                            logging: true // Enable logging for debugging
                        },
                        jsPDF: { 
                            unit: 'mm', 
                            format: 'a4', 
                            orientation: 'portrait',
                            compress: true
                        },
                        pagebreak: { 
                            mode: 'css',
                            // before: '.page-break'
                        }
                    };
                    
                    html2pdf().from(contentForPdf).set(opt).save().then(() => {
                        // Hide headers and remove the clone after PDF generation
                        setTimeout(function() {
                            document.body.removeChild(contentForPdf);
                        }, 1000);
                    });
                });
            </script>

            <!-- <script>
                // Fetch the key from our server endpoint first
                fetch('/api/maps-key')
                    .then(response => response.json())
                    .then(data => {
                        const script = document.createElement('script');
                        script.src = `https://maps.googleapis.com/maps/api/js?key=${data.key}&libraries=places&callback=initAutocomplete`;
                        script.async = true;
                        script.defer = true;
                        document.head.appendChild(script);
                    })
                    .catch(error => console.error('Error loading Google Maps:', error));
            </script> -->

        </body>
        
    </html>
