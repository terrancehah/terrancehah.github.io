<!DOCTYPE html>

    <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link href="./style.css" type="text/css" rel="stylesheet">
            <link href="./travel-rizz.css" type="text/css" rel="stylesheet">
            <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
            <link rel="icon" type="image/x-icon" href="/resources/TH-logo.png">
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
            <meta property="og:title" content="Travel-Rizz - Your friendly AI-powered travel companion.">
            <meta name="og:description" content="Experience the charm of travel planning with Travel-Rizz. Let AI be your guide!">
            <meta property="og:image" content="https://terrancehah.com/resources/TH-logo.jpg">
            <meta property="og:type" content="article">
            <meta property="og:url" content="https://terrancehah.com/travel-planner-index.html">
            <meta name="description" content="Travel-Rizz: Your Personalized Journey Awaits">
            <script>window.si = window.si || function () { (window.siq = window.siq || []).push(arguments); };</script>
            <script defer src="/_vercel/speed-insights/script.js"></script>
            <script defer data-domain="terrancehah.com" src="https://plausible.io/js/script.tagged-events.js"></script>
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDvcgBgSprgTRQO_6BWh5EAOPu1vdS6KD4&libraries=places&callback=initAutocomplete" async defer></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
            <script src="./footer.js"></script>
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
            </style>
            <title>Travel-Rizz - Your friendly AI-powered travel companion.</title>
        </head>

        <body>
            <header>
                <h1>Travel-Rizz</h1>
                <nav>
                    <a class="navbutton" href="./index.html">Home</a>
                    <a class="navbutton" href="./articles.html">Articles</a>
                    <a class="navbutton active" href="./projects.html">Projects</a>
                    <a class="navbutton" href="./playground.html">Playground</a>
                </nav>
                    <a class="contacts" href="https://facebook.com/terrancehah/" target="_blank"><img src="./resources/facebook.png" alt="facebook"></a>
                    <a class="contacts" href="https://instagram.com/terrancehah/" target="_blank"><img src="./resources/instagram.png" alt="instagram"></a>
                    <a class="contacts" href="https://www.linkedin.com/in/terrancehah/" target="_blank"><img src="./resources/linkedin.png" alt="linkedin"></a>
                    <a class="contacts" href="https://github.com/terrancehah" target="_blank"><img src="./resources/github.png" alt="github"></a>
                <style>
                    @import url('https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
                </style>
            </header>
            
            <main>
                    <video id="backgroundVideo" autoplay muted>
                        <source id="videoSource" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>

                    <div class="intro-caption">
                        <h1 class="heading">Welcome to Travel-Rizz: 
                            <br>Your Personalized Journey Awaits</h1>
                    <h3 class="subheading">Discover the joy of seamless travel planning with Travel-Rizz, your friendly AI travel assistant.</h3>
                    </div>

                    <div class="itinerary-planner">   
                        <form id="trip-form">
                            <div class="destination-input-form" action="">
                                <input type="search" id="destination"name="city" placeholder="Any place in your mind?" autocomplete="off">
                                <div id="cityList"></div>
                            </div>                
                            <div class="calendar-container">
                                <div class="planner-input-form inline-calendar" id="start-calendar">
                                    <input id="start-date" name="startDate" class="date-picker planner-input-form" placeholder="Start Date" readonly required>
                                </div>
                            </div>
                            <div class="calendar-container">
                                <div class="planner-input-form inline-calendar" id="end-calendar">
                                    <input id="end-date" name="endDate" class="date-picker planner-input-form" placeholder="End Date" readonly required>
                                    <input type="hidden" id="hidden-end-date" name="endDate">
                                </div>
                            </div>

                            <div>
                                <select id="language">
                                    <option value="en">English</option>
                                    <option value="ms">Malay (Bahasa Melayu)</option>
                                    <option value="es">Español</option>
                                    <option value="fr">Français</option>
                                    <option value="de">Deutsch</option>
                                    <option value="it">Italiano</option>
                                    <option value="cs">Czech (Čeština)</option>
                                    <option value="zh-CN">Simplified Chinese (简体中文)</option>
                                    <option value="zh-TW">Traditional Chinese (繁體中文)</option>
                                    <option value="ja">Japanese (日本語)</option>
                                    <option value="ko">Korean (한국어)</option>
                                </select>
                            </div>

                            <button id="generate-button" type="submit">Take Me There</button>
                            <!-- //Test button -->
                            <!-- <button id="loadTestData" type="submit">Load Test Data</button> -->

                        </form>
                    </div>
            </main>

            <div id="popupWindow" class="popup-window">
                <div class="popup-content">
                    <span class="close-btn" onclick="closePopup()">&times;</span>
                    <div id="generatedContent" class="generated-content">
                    </div>
                    <button id="exportPDF">Export as PDF</button>
                </div>
            </div>
            <div id="loadingSpinner" style="display: none;">
                <img id="plane" src="resources/flyingplane-crop.gif"  alt="Loading..."/>
                <p>Fasten your seat belt while we are working on your travel itinerary...</p>
            </div>            

            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

            <!-- <script>
                var wrappers = $(".button-wrapper");
            
                $(".submit").click(function(e) {
                    e.preventDefault();
            
                    var clickedWrapper = $(this).parent(".button-wrapper");
            
                    if(!clickedWrapper.hasClass("checked")) {
                        clickedWrapper.addClass("checked");
            
                        setTimeout(function(){
                            window.location.href = $(e.target).attr("href");
                        }, 5000);
            
                        setTimeout(function(){
                            clickedWrapper.removeClass("checked");
                        }, 8000);
                    }
                });
            </script> -->


            <script>
                //Random loop autoplay background videos
                document.addEventListener('DOMContentLoaded', function() {
                    var videos = [
                        './resources/Dubai_Night_1080P_20X_compressed.mp4',
                        './resources/London_Skyline_720P_8X_compressed.mp4',
                        './resources/Patagonia_Lake_720P_20X_compressed.mp4',
                        './resources/Grand_Canyon_720P_8X_compresed.mp4',
                        './resources/Greenland_Evening_1080P_20X_compressed.mp4',
                        './resources/San_Fransisco_Bay_720P_5X_compressed.mp4'
                        // Add more video paths as needed
                    ];
            
                    // Randomly select the first video
                    var firstVideoIndex = Math.floor(Math.random() * videos.length);
                    var videoElement = document.getElementById('backgroundVideo');
                    videoElement.src = videos[firstVideoIndex];
                    videoElement.load(); // Ensure the new source is loaded
            
                    videoElement.addEventListener('ended', function(e) {
                        // Determine the next video index
                        var currentVideoIndex = videos.indexOf(videoElement.getAttribute('src'));
                        var nextVideoIndex = (currentVideoIndex + 1) % videos.length;
                        videoElement.src = videos[nextVideoIndex];
                        videoElement.load(); // Load the new video source
                        videoElement.play(); // Play the next video
                    });
                });
            </script>            

            <script async
            src="https://js.stripe.com/v3/buy-button.js">
            </script>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    var stripeButton = document.querySelector('.stripe-buy-button');
                    if (stripeButton) {
                        stripeButton.addEventListener('click', function() {
                        plausible('Stripe Purchase Button Click');
                        });
                    }
                });
            </script>

            <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

            <script>
                // City name autocomplete
                function initAutocomplete() {
                    var input = document.getElementById('destination');
                    var autocomplete = new google.maps.places.Autocomplete(input);
                    autocomplete.addListener('place_changed', function() {
                        var place = autocomplete.getPlace();
                        if (!place.geometry) {
                            console.log("No details available for input: '" + place.name + "'");
                            return;
                        }

                        // Extract city and country from address components
                        var city, country;
                        for (var i = 0; i < place.address_components.length; i++) {
                            var component = place.address_components[i];
                            if (component.types.includes("locality")) {
                                city = component.long_name;
                            }
                            if (component.types.includes("country")) {
                                country = component.long_name;
                            }
                        }

                        var simplifiedPlaceName = city && country ? city + ", " + country : place.name;
                        console.log('Simplified place name:', simplifiedPlaceName);
                    });
                }
            </script>
            

            <script>
                var today = new Date();
                var mainCalendar, endCalendar;
                var currentMode = "";

                function initializeCalendar() {
                    var isMobile = window.matchMedia("only screen and (max-width: 1024px)").matches;
                    var wideMode = isMobile ? "mobile" : "desktop";

                    if (currentMode !== wideMode) {
                        // Destroy existing calendars
                        if (mainCalendar) {
                            mainCalendar.destroy();
                            mainCalendar = null;
                        }
                        if (endCalendar) {
                            endCalendar.destroy();
                            endCalendar = null;
                        }

                        //Mobile mode
                        if (isMobile) {
                             // Set a different placeholder for mobile view
                            document.getElementById("start-date").setAttribute("placeholder", "Start and End Dates");

                            // Initialize the mobile calendar in range mode
                            mainCalendar = flatpickr("#start-calendar", {
                                inline: true,
                                dateFormat: "d-m-Y",
                                minDate: today,
                                mode: "range",
                                onChange: function(selectedDates, dateStr) {
                                    if (selectedDates.length === 2) {
                                        // Format and display both dates when two dates are selected
                                        var startDateFormatted = flatpickr.formatDate(selectedDates[0], "d-m-Y");
                                        var endDateFormatted = flatpickr.formatDate(selectedDates[1], "d-m-Y");
                                        document.getElementById("start-date").value = `${startDateFormatted} to ${endDateFormatted}`;
                                        document.getElementById("hidden-end-date").value = endDateFormatted;
                                    } else {
                                        // Display only the start date when one date is selected
                                        document.getElementById("start-date").value = dateStr;
                                        document.getElementById("hidden-end-date").value = dateStr;
                                    }
                                },
                            });
                            document.getElementById("end-calendar").style.display = 'none';
                            document.getElementById("end-date").required = false;
                        } else {
                            // Initialize the main calendar for desktop in single mode
                            mainCalendar = flatpickr("#start-calendar", {
                                inline: true,
                                dateFormat: "d-m-Y",
                                minDate: today,
                                onChange: function(selectedDates, dateStr) {
                                    document.getElementById("start-date").value = dateStr;
                                    endCalendar.set('minDate', dateStr);
                                },
                                onMonthChange: function(selectedDates, dateStr, instance) {
                                    // Update the month of the end calendar when the main calendar month changes
                                    var year = instance.currentYear;
                                    var month = instance.currentMonth;
                                    endCalendar.jumpToDate(new Date(year, month));
                                }
                            });

                            // Initialize the end calendar for desktop
                            endCalendar = flatpickr("#end-calendar", {
                                inline: true,
                                dateFormat: "d-m-Y",
                                minDate: today,
                                onChange: function(selectedDates, dateStr) {
                                    document.getElementById("end-date").value = dateStr;
                                }
                            });
                            document.getElementById("end-date").required = true;
                            document.getElementById("end-calendar").style.display = 'block';
                        }

                        // Toggle visibility
                        document.getElementById("start-calendar").style.display = 'block';
                        document.getElementById("start-date").style.display = 'relative';
                        document.getElementById("end-date").style.display = isMobile ? 'none' : 'relative';

                        currentMode = wideMode;
                    }
                }

                $(document).ready(function() {
                    initializeCalendar();
                });

                var resizeTimer;
                $(window).resize(function() {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(initializeCalendar, 250);
                });
            </script>


            <script>
                // Listen to the input, parse into JSON format and receive the JSON format response
                document.getElementById("trip-form").addEventListener("submit", function(e) {
                    e.preventDefault();

                    // Show loading spinner
                    document.getElementById("loadingSpinner").style.display = "flex";

                    var isMobile = window.matchMedia("only screen and (max-width: 1024px)").matches;
                    var city = document.getElementById("destination").value;
                    var startDate = document.getElementById("start-date").value;
                    var endDate = isMobile ? document.getElementById("hidden-end-date").value : document.getElementById("end-date").value;
                    var language = document.getElementById("language").value;

                    // Log the raw values
                    console.log('Raw form values:', {
                        city,
                        startDate,
                        endDate,
                        language
                    });
                    
                    // // Validate data before sending
                    // if (!city || !startDate || !endDate || !language) {
                    //     document.getElementById("loadingSpinner").style.display = "none";
                    //     alert('Please fill in all required fields');
                    //     return;
                    // }

                    // Use explicit object notation
                    var requestData = {
                        "language": language,
                        "city": city,
                        "startDate": startDate,
                        "endDate": endDate
                    };

                    var isLocal = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                    const apiUrl = isLocal ? 'http://localhost:3000/api/travel-rizz-server' : '/api/travel-rizz-server';

                    // Log the request for debugging
                    console.log('Sending request:', {
                        url: apiUrl,
                        data: requestData
                    });

                    // Make the fetch request
                    fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(requestData)
                    })
                    .then(response => {
                        console.log('Response status:', response.status);
                        return response.json();  // Use response.json() directly
                    })
                    .then(data => {
                        // Log received data
                        console.log('Parsed data:', data);
                        
                        // Validate received content
                        if (!data || typeof data.generatedContent !== 'string') {
                            console.error('Invalid response format:', data);
                            throw new Error('Invalid response format from server');
                        }

                        console.log('Success:', data);
                        if (data.generatedContent) {
                            document.getElementById("generatedContent").innerHTML = data.generatedContent;
                            document.getElementById("loadingSpinner").style.display = "none";
                            openPopup();
                        } else {
                            throw new Error('No content received from server');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        document.getElementById("loadingSpinner").style.display = "none";
                        
                        // More descriptive error message
                        if (error.name === 'SyntaxError') {
                            alert('Received malformed data from server. Please try again.');
                        } else {
                            alert(`Error: ${error.message || 'Failed to generate itinerary'}`);
                        }
                    });
                });
            </script>
            

            <!-- // Static data for testing only -->
            <!-- <script>
                var testData = 
                    `
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h1>欢迎来到麻坡！</h1>
                        <h2>城市介绍</h2>
                        <p>麻坡是马来西亚柔佛州的一座具有悠久历史和丰富文化底蕴的城市。它以其美丽的传统建筑、精彩的街头美食和友好的居民而闻名，吸引着众多游客前来探索。麻坡还是连接柔佛州和马六甲的重要交通枢纽，方便旅客在这两地之间往返。</p>
                        <h2>季节与气候</h2>
                        <p>麻坡的气候为典型的热带雨林气候，全年温暖潮湿，充满活力。每年的10月到11月属于雨季，降雨较为频繁。然而，降雨通常较为短暂，之后便是湿润的晴天，适合旅行。访问期间的天气情况可以参考<a href="https://www.accuweather.com/en/my/muar/233140/october-weather/233140?year=2024" target="_blank">Muar November 2024 Weather</a>。</p>
                        <h2>语言</h2>
                        <p>在麻坡，主要语言包括马来语、中文（普通话及各方言）和英语。由于当地多元文化的特征，您可能会在市场、餐馆及商铺听到多种语言的交流。语言的多样性为游客与本地人之间的互动增添了便利。</p>
                        <h2>人口</h2>
                        <p>麻坡的人口大约为23万人，构成多元的种族与文化社区。这里居民主要由马来族、华人和印度裔等组成，这种丰富的文化融汇增强了麻坡的魅力。</p>
                    </div>
                    
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header> 
                        <h1>Notable Details about Muar, Johor</h1>
                        <h2>货币信息</h2>
                        <p>Muar位于马来西亚，使用的货币是马来西亚令吉(MYR)。为了获得实时汇率信息，请访问<a href="https://www.x-rates.com/table/?from=MYR&amount=1" target="_blank">汇率表</a>。建议随身携带少量现金，以便在较小的商店和市场使用。</p>
                        <h2>安全提示</h2>
                        <p>Muar总体上是一个安全的旅行目的地，但仍需注意基本安全措施。建议游客尽量避免在夜间独自出行，并随时注意个人物品，以防扒窃事件发生。</p>
                        <h2>营业时间</h2>
                        <p>在Muar，大部分商店和餐厅的营业时间为上午10点至晚上10点。需要注意的是，某些地方可能在祷告时间（周五中午）短暂关闭。</p>
                        <h2>当地交通</h2>
                        <p>在Muar，游客可以通过公共巴士、出租车或租赁自行车进行导航。更多详细信息与时刻表，请访问公共交通相关网站，使用导航工具时，可通过手机应用程序获取指路服务。</p>
                    </div>
                    
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h1>2024年11月10日: 探索麻坡的魅力</h1>
                        <h2><strong>上午</strong></h2>
                        <p>您的麻坡之旅从参观<a href="https://www.google.com/maps/search/?api=1&query=%E9%BA%BB%E5%9D%A1%E5%A4%A7%E9%92%9F%E6%A5%BC%2C%20muar%2C%20johor" target="_blank">麻坡大钟楼</a>开始。麻坡大钟楼是这座城市的象征之一，建于1909年。在这座高耸的建筑中，您可以感受到历史的沉淀。从这里出发，步行不久即可到达<a href="https://www.google.com/maps/search/?api=1&query=%E9%BA%BB%E5%9D%A1%E8%80%81%E8%A1%97%2C%20muar%2C%20johor" target="_blank">麻坡老街</a>。这条街道充满了马来西亚的老式商铺和地道的食品摊位，让您体验本地人的日常生活。</p>
                        <h2><strong>下午</strong></h2>
                        <p>午餐后，您可以步行至附近的<a href="https://www.google.com/maps/search/?api=1&query=%E6%B8%85%E7%9C%9F%E5%AF%BA%E8%8B%8F%E4%B8%B9%E4%BE%9D%E5%B8%83%E6%8B%89%E6%AC%A3%E5%A4%A7%E5%8E%A6%2C%20muar%2C%20johor" target="_blank">清真寺苏丹依布拉欣大厦</a>，这是一座融合了摩尔与维多利亚风格的优雅建筑。随后前往<a href="https://www.google.com/maps/search/?api=1&query=%E9%BA%BB%E5%9D%A1%E8%89%BA%E6%9C%AF%E8%A1%97%2C%20muar%2C%20johor" target="_blank">麻坡艺术街</a>，这里的墙壁上装饰着五彩缤纷的壁画和创新的艺术作品，非常适合拍照留念。所有这些景点都在步行距离之内，让您轻松畅游。</p>
                        <h2><strong>晚上</strong></h2>
                        <p>晚上，前往<a href="https://www.google.com/maps/search/?api=1&query=Tanjung%20Emas%20%E5%85%AC%E5%9B%AD%2C%20muar%2C%20johor" target="_blank">Tanjung Emas 公园</a>，这是当地居民的热门休闲场所。在公园里，您可以漫步于海滨小径，欣赏夕阳下的麻坡河美景。如果饿了，不远处有一家受欢迎的餐馆，<a href="https://www.google.com/maps/search/?api=1&query=Jeti%20Laut%20%E5%B7%B4%E5%8E%98%E9%A3%8E%E5%91%B3%E9%A4%90%E5%8E%85%2C%20muar%2C%20johor" target="_blank">Jeti Laut 巴厘风味餐厅</a>，提供新鲜的海鲜佳肴。</p>
                        <h2><strong>夜间</strong></h2>
                        <p>结束这一天的行程，可以在<a href="https://www.google.com/maps/search/?api=1&query=%E9%BA%BB%E5%9D%A1%E6%B2%B3%E6%BB%A8%E9%95%BF%E5%BB%8A%2C%20muar%2C%20johor" target="_blank">麻坡河滨长廊</a>漫步，享受傍晚的凉风和城市夜景。河滨步道上设有多处美丽的灯光装饰，给夜晚增加了不少浪漫气息。</p>
                    </div>
                    
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h1>旅行提醒</h1><h2>旅行文件和签证要求</h2><p>请确保您的护照在入境至少六个月内有效。有关签证要求，您可以访问 <a href="https://mzv.gov.cz/jnp/en/information_for_aliens/visa_form/index.html" target="_blank">官方签证申请网站</a> 了解详细信息。</p>
                        <h2>退税手续</h2>
                        <p>在马来西亚购物时，请留意参与退税计划的商店。离境时可到机场办理退税手续，携带好相关发票和商品。</p>
                        <h2>最新时事和建议</h2>
                        <p>请及时关注最新的旅行公告和安全建议。了解和遵循当地政府的指导，以确保安全无虞。</p>
                        <h2>当地礼仪和文化规范</h2>
                        <p>尊重当地文化是很重要的。在穆斯林区域，着装宜保守。此外，马来西亚人通常比较热情友好，见面问候时可说“你好”或使用当地的马来语“Selamat sejahtera”。</p>
                        <h2>健康和疫苗接种记录要求</h2><p>建议旅客前往马来西亚前确认所需疫苗接种情况。确保携带最新的疫苗接种记录，以备不时之需。</p>
                    </div>
                    
                    <div class="page-break">
                        <header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h1>紧急联系方式</h1>
                        <h2>紧急电话</h2>
                        <p>警察：999</p><p>救护车：999</p><p>消防队：994</p>
                        <h2>医院</h2>
                        <p>Tunku Ampuan Najihah Hospital<br>电话：06-952 2600<br>地址：Jalan Temenggung, 84000 Muar, Johor, Malaysia<br><a href="https://goo.gl/maps/LBf6neEzfzQ2" target="_blank"><a href="https://www.google.com/maps/search/?api=1&query=Tunku%20Ampuan%20Najihah%20Hospital%2C%20muar%2C%20johor" target="_blank">Tunku Ampuan Najihah Hospital</a></a></p>
                        <p>Sultanah Fatimah Specialist Hospital<br>电话：06-952 2500<br>地址：Jalan Salleh, 84000 Muar, Johor, Malaysia<br><a href="https://goo.gl/maps/ZTPpS2EmZ8K2" target="_blank"><a href="https://www.google.com/maps/search/?api=1&query=Sultanah%20Fatimah%20Specialist%20Hospital%2C%20muar%2C%20johor" target="_blank">Sultanah Fatimah Specialist Hospital</a></a></p>
                        <h2>使馆信息</h2>
                        <p>为了确保您的安全，请牢记您所在国在马来西亚的使馆或领事馆的地址和联系信息。详情请访问 <a href="https://www.embassy-worldwide.com/" target="_blank">全球使馆指南</a>。</p>
                    </div>

                    <div class="page-break"><header><img id='logo' src='resources/TH-logo.png' alt='logo'/><h2 id='brand'>Travel-Rizz</h2><h2 id='header-slogan'>Travel-Rizz:Your Personalized Journey Awaits</h2></header>
                        <h2 id='conclusion'>我们衷心祝愿您在麻坡的旅程充满乐趣与惊喜。我们热情地邀请您在旅途中留下美好回忆，并希望您能在线分享您的体验和反馈。如果我们的行程安排对您有帮助，我们会感到非常荣幸。</h2>
                    </div>
                    `

                document.getElementById('loadTestData').addEventListener('click', function() {
                    document.getElementById("generatedContent").innerHTML = testData;
                    openPopup();
                });
            </script> -->

            <script>
                function openPopup() {
                    document.getElementById("popupWindow").style.display = "block";
                }

                function closePopup() {
                    document.getElementById("popupWindow").style.display = "none";
                }
            </script>

            <script>
                document.getElementById('exportPDF').addEventListener('click', function(e) {
                    e.preventDefault();

                    var isMobile = window.matchMedia("only screen and (max-width: 1024px)").matches;
                    var city = document.getElementById("destination").value;
                    var originalContent = document.getElementById("generatedContent");
                    var startDate = document.getElementById("start-date").value;
                    var endDate = isMobile ? document.getElementById("hidden-end-date").value : document.getElementById("end-date").value;

                    // Clone the content for PDF generation
                    var contentForPdf = originalContent.cloneNode(true);
                    contentForPdf.id = 'contentForPdf';
                    document.body.appendChild(contentForPdf);

                    // Apply PDF specific font sizing
                    contentForPdf.querySelectorAll('h1').forEach(el => el.style.fontSize = '50px');
                    contentForPdf.querySelectorAll('h2').forEach(el => el.style.fontSize = '32px');
                    contentForPdf.querySelectorAll('.generated-content #brand').forEach(el => el.style.fontSize = '26px');
                    contentForPdf.querySelectorAll('.generated-content #header-slogan').forEach(el => el.style.fontSize = '20px');
                    contentForPdf.querySelectorAll('strong').forEach(el => el.style.fontSize = '22px');
                    contentForPdf.querySelectorAll('p').forEach(el => el.style.fontSize = '18px');                    
                    // contentForPdf.querySelectorAll('.page-break').forEach(el => el.style.marginBottom = '0');                    
                    // contentForPdf.querySelectorAll('img').forEach(el => el.style.marginTop = '0.5%');
                    // contentForPdf.querySelectorAll('#conclusion').forEach(el => el.style.height = '95vh');

                    // Style headers
                    contentForPdf.querySelectorAll('.generated-content header').forEach(header => {
                        header.style.display = 'inline-flex';
                        // header.style.position = 'absolute';
                        header.style.top = '0';
                        header.style.left = '0';
                        header.style.right = '0';
                        // header.style.padding = '20px';
                    });

                    // Get all page breaks and identify the last one
                    const pageBreaks = contentForPdf.querySelectorAll('.page-break');
                    const lastPageIndex = pageBreaks.length - 1;

                    // Style page breaks and handle content
                    pageBreaks.forEach((el, index) => {
                        el.style.position = 'relative';
                        el.style.display = 'flex';
                        el.style.flexDirection = 'column';
                        el.style.minHeight = '100vh';

                        
                        // Only set minHeight for non-last pages
                        // if (index !== lastPageIndex) {
                        //     el.style.minHeight = '100vh';
                        // }
                        
                        // Create content wrapper
                        const content = document.createElement('div');
                        content.style.flex = '1';
                        content.style.display = 'flex';
                        content.style.flexDirection = 'column';
                        content.style.justifyContent = 'center';
                        
                        // Special handling for conclusion page
                        const conclusionH2 = el.querySelector('#conclusion');
                        if (conclusionH2) {
                            conclusionH2.style.whiteSpace = 'normal';
                            conclusionH2.style.width = '95%';
                            conclusionH2.style.maxWidth = '100%';
                            conclusionH2.style.wordBreak = 'normal';
                            conclusionH2.style.wordWrap = 'break-word';
                            conclusionH2.style.overflowWrap = 'break-word';
                            conclusionH2.style.textAlign = 'center';
                            conclusionH2.style.display = 'block';
                            conclusionH2.style.lineHeight = '1.5';
                            conclusionH2.style.margin = '0 auto';
                            conclusionH2.style.padding = '20px';  // Increased padding

                            // Force the conclusion page to take up full height
                            el.style.minHeight = '100vh';
                            // el.style.height = '100vh';

                            // Ensure content is centered vertically
                            content.style.flex = '1';
                            content.style.display = 'flex';
                            content.style.alignItems = 'center';
                            content.style.justifyContent = 'center';
                            
                            // Remove any bottom margin/padding that might cause extra space
                            el.style.marginBottom = '0';
                            el.style.paddingBottom = '0';
                            content.style.margin = '0';
                            content.style.marginBottom = '0';
                            content.style.paddingBottom = '0';
                            
                            // // For the conclusion page, set a specific height
                            // if (index === lastPageIndex) {
                            //     el.style.height = 'auto';
                            //     el.style.minHeight = 'auto';
                            //     // content.style.paddingBottom = '40px'; // Add some bottom padding
                            // }
                        }

                        // Move all non-header content to wrapper
                        Array.from(el.children).forEach(child => {
                            if (child.tagName.toLowerCase() !== 'header') {
                                content.appendChild(child);
                            }
                        });
                        
                        el.appendChild(content);
                    });

                    var opt = {
                        margin: [10, 17, 12, 17],
                        filename: city + '_' + 'Travel_Itinerary' + '_' + startDate + '_to_' + endDate + '.pdf',
                        image: { type: 'jpeg', quality: 0.98 },
                        html2canvas: { 
                            scale: 2,
                            useCORS: true,
                            scrollY: 0,
                            // windowWidth: document.documentElement.clientWidth,   // Ensure full width is captured
                            // windowHeight: document.documentElement.clientHeight, // Ensure full height is captured
                            logging: true // Enable logging for debugging
                        },
                        jsPDF: { 
                            unit: 'mm', 
                            format: 'a4', 
                            orientation: 'portrait',
                            compress: true
                        },
                        pagebreak: { 
                            mode: 'css',
                            // before: '.page-break'
                        }
                    };
                    
                    html2pdf().from(contentForPdf).set(opt).save().then(() => {
                        // Hide headers and remove the clone after PDF generation
                        setTimeout(function() {
                            document.body.removeChild(contentForPdf);
                        }, 1000);
                    });
                });
            </script>

            <!-- <script>
                // Fetch the key from our server endpoint first
                fetch('/api/maps-key')
                    .then(response => response.json())
                    .then(data => {
                        const script = document.createElement('script');
                        script.src = `https://maps.googleapis.com/maps/api/js?key=${data.key}&libraries=places&callback=initAutocomplete`;
                        script.async = true;
                        script.defer = true;
                        document.head.appendChild(script);
                    })
                    .catch(error => console.error('Error loading Google Maps:', error));
            </script> -->

        </body>
        
    </html>
